#!/usr/bin/env ruby

if ENV['RUBY_TRACE_ALLOCATIONS'] == "yep"
  require 'objspace'

  ObjectSpace.trace_object_allocations_start
end

require 'sigdump'
Sigdump.setup('SIGCONT', '+')

require 'rbtrace'
require 'mobystash'

begin
  Mobystash.new(ENV).start
rescue Mobystash::Config::InvalidEnvironmentError => ex
  $stderr.puts "F Invalid configuration: #{ex.message}"
  exit 1
end
